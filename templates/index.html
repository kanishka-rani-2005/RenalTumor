<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Object Classification</title>
    <!-- Favicon -->
	<link rel="shortcut icon"
        href="data:image/png;base64,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" />
    <!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	
	<style>
		:root {
			--primary-color: #4a69bd;
			--secondary-color: #6a89cc;
			--background-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
			--text-dark: #333;
			--text-light: #777;
			--card-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
			--input-border: #ced4da;
		}

		body {
			font-family: 'Poppins', sans-serif;
			background: var(--background-gradient);
			color: var(--text-dark);
			display: flex;
			align-items: center;
			justify-content: center;
			min-height: 100vh;
			padding: 2rem;
		}

		.main-panel {
			background-color: #fff;
			border-radius: 15px;
			box-shadow: var(--card-shadow);
			padding: 2rem 3rem;
			width: 100%;
			max-width: 1200px;
		}

		.iupload h3 {
			color: var(--text-dark);
			font-size: 2.2rem;
			font-weight: 600;
			margin-bottom: 2rem;
		}
		
		/* --- Left Column: Uploader --- */
		.upload-section {
			display: flex;
			flex-direction: column;
			align-items: center;
		}

		.image-preview-box {
			height: 320px;
			width: 320px;
			border: 2px dashed var(--input-border);
			border-radius: 10px;
			display: flex;
			align-items: center;
			justify-content: center;
			background-color: #f8f9fa;
			position: relative;
			overflow: hidden;
		}

		.image-preview-box img,
		.image-preview-box video {
			position: absolute;
			height: 100%;
			width: 100%;
			object-fit: cover;
			padding: 5px;
		}
		
		.image-preview-box #photo { display: none; }
		.image-preview-box #video { display: block; }

		.btn-part {
			width: 320px;
			margin-top: 1.5rem;
		}
		
		.btn-part .btn {
			width: 100%;
			padding: 0.75rem;
			font-size: 1rem;
			font-weight: 500;
			border-radius: 8px;
			border: none;
			transition: all 0.3s ease;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
		}

		.btn-part .btn:hover {
			transform: translateY(-3px);
			box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
		}

		.btn-primary {
			background-color: var(--primary-color);
		}
		.btn-primary:hover {
			background-color: #3b5998;
		}

		.btn-success {
			background-color: #28a745;
		}
		.btn-success:hover {
			background-color: #218838;
		}

		.hidden-file-input {
			display: none;
		}

		/* --- Right Column: Results --- */
		.results-section {
			border-left: 1px solid #e0e0e0;
			padding-left: 2rem;
			height: 100%;
		}
		
		.results-section h5 {
			font-weight: 600;
			color: var(--text-dark);
			font-size: 1.5rem;
			margin-bottom: 1.5rem;
		}

		.results-container {
			background-color: #fdfdfd;
			border: 1px solid #f0f0f0;
			border-radius: 10px;
			padding: 1rem;
			height: calc(100% - 4rem);
			overflow-y: auto;
		}

		#result-image-wrapper .resp-img {
			max-width: 100%;
			height: auto;
			border-radius: 8px;
			margin-bottom: 1rem;
			border: 1px solid #eee;
		}

		#result-json-wrapper pre {
			background-color: #f8f9fa;
			border: 1px solid #e9ecef;
			border-radius: 5px;
			padding: 15px;
			font-size: 0.9em;
			color: #333;
			white-space: pre-wrap;
			word-wrap: break-word;
		}
		
		/* --- Loader --- */
		#loading {
			position: fixed;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			z-index: 9999999999;
			background: rgba(255, 255, 255, 0.85);
			/* backdrop-filter: blur(4px); */
		}
		.loader {
			border: 8px solid #f3f3f3;
			border-top: 8px solid var(--primary-color);
			border-radius: 50%;
			width: 60px;
			height: 60px;
			position: absolute;
			top: 50%;
			left: 50%;
			margin-top: -30px;
			margin-left: -30px;
			animation: spin 1.5s linear infinite;
		}
		@keyframes spin {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}

		/* --- Responsive Design --- */
		@media (max-width: 991px) {
			.results-section {
				border-left: none;
				padding-left: 0;
				margin-top: 3rem;
				border-top: 1px solid #e0e0e0;
				padding-top: 2rem;
			}
			.main-panel {
				padding: 2rem;
			}
		}

		@media (max-width: 767px) {
			.iupload h3 { font-size: 1.8rem; }
			.main-panel { padding: 1.5rem; }
			.image-preview-box, .btn-part {
				width: 100%;
				max-width: 320px;
			}
		}
	</style>
</head>
<body>
    <div class="main-panel">
		<section class="iupload">
			<h3 class="text-center">Object Classification</h3>
			<div class="row">
				<!-- Uploader Column -->
				<div class="col-lg-6 d-flex justify-content-center">
					<div class="upload-section">
						<div class="image-preview-box">
							<video autoplay id="video" poster="https://img.freepik.com/free-vector/group-young-people-posing-photo_52683-18824.jpg?size=338&ext=jpg"></video>
							<img src="" id="photo">
							<canvas style="display:none;" id="canvas"></canvas>
						</div>
						<div class="btn-part">
							<form id="upload-data" class="w-100">
								<div class="form-group mt-3">
									<button type="button" class="btn btn-primary" id="uload">Upload Image</button>
								</div>
								<div class="form-group">
									<button id="send" type="button" class="btn btn-success">Predict</button>
								</div>
								
								<!-- Hidden Fields -->
								<input type="hidden" id="url" value="../predict"/>
								<input name="upload" type="file" id="fileinput" class="hidden-file-input" accept="image/*" />
							</form>
						</div>
					</div>
				</div>

				<!-- Results Column -->
				<div class="col-lg-6">
					<div class="results-section">
						<h5 class="text-center">Prediction Results</h5>
						<div class="results-container">
							<!-- Image result will be inserted here -->
							<div id="result-image-wrapper"></div>
							<!-- JSON result will be inserted here -->
							<div id="result-json-wrapper"></div>
						</div>
					</div>
				</div>

			</div>
		</section>
	</div>

<div id="loading"><div class="loader"></div></div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<script>
var myvideo = document.getElementById('video');
var mycanvas = document.getElementById('canvas');
var myphoto = document.getElementById('photo');
var base_data = "";

function sendRequest(base64Data){
	if(base64Data === "" || base64Data === null){
		alert("Please upload an image first.");
		return;
	}
	
	var url = $("#url").val();
	$("#loading").show();

	$.ajax({
		url : url,
		type: "post",
		cache: false,
		async: true,
		crossDomain: true,
		headers: {
			'Content-Type': 'application/json',
			'Access-Control-Allow-Origin':'*'
		},
		data:JSON.stringify({image:base64Data}),
		success: function(res){
			// Clear previous results
			$("#result-image-wrapper").empty();
			$("#result-json-wrapper").empty();
			
			// Handle the image part of the response
			try{
				if(res[1] && res[1].image){
					var imageData = res[1].image;
					if(imageData.length > 100){
						$("#result-image-wrapper").append("<img class='resp-img' src='data:image/jpeg;base64," + imageData + "' alt='Processed Image' />");
					}
				}
			} catch(e){
				console.error("Error processing response image:", e);
			}
			
			// Handle the JSON part of the response
			$("#result-json-wrapper").html("<pre>" + JSON.stringify(res[0], undefined, 2) + "</pre>");
			
			$("#loading").hide();
		},
		error: function(jqXHR, textStatus, errorThrown){
			$("#loading").hide();
			$("#result-json-wrapper").html("<pre>Error: " + textStatus + "\n" + errorThrown + "\n" + jqXHR.responseText + "</pre>");
			alert("An error occurred while sending the request. Please check the console and the REST API URL.");
		}
	});
}

$(document).ready(function(){
	$("#loading").hide();

	$('#send').click(function(evt){
		sendRequest(base_data);
    });

    $('#uload').click(function(evt) {
        $('#fileinput').click(); // Use click() directly for simplicity
    });

	$("#fileinput").change(function(){
		if (this.files && this.files[0]){
			var reader = new FileReader();
			reader.onload = function (e){
				var url = e.target.result;
				var img = new Image();
				img.crossOrigin = 'Anonymous';
				img.onload = function(){
					var canvas = document.createElement('CANVAS');
					var ctx = canvas.getContext('2d');
					canvas.height = this.naturalHeight;
					canvas.width = this.naturalWidth;
					ctx.drawImage(this, 0, 0);
					// Strip the data type prefix for the payload
					base_data = canvas.toDataURL('image/jpeg', 1.0).replace(/^data:image.+;base64,/, '');
					canvas = null;
				};
				img.src = url;

				// Update the preview
				$('#photo').attr('src', url);
				$('#photo').show();
				$('#video').hide();
			}
			reader.readAsDataURL(this.files[0]);
		}
	});
});

</script>
</body>
</html>